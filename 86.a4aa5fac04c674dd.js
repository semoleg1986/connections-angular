"use strict";(self.webpackChunkconnections=self.webpackChunkconnections||[]).push([[86],{7086:(Et,q,r)=>{r.r(q),r.d(q,{ChatModule:()=>Rt});var l=r(6814),u=r(3573),t=r(5879),C=r(8645),v=r(5592),T=r(4664),Q=r(6321),j=r(9080);function Z(o=0,s=Q.z){return o<0&&(o=0),(0,j.H)(o,o,s)}var O=r(7398),H=r(9360),K=r(8251);function I(o,s=!1){return(0,H.e)((e,n)=>{let i=0;e.subscribe((0,K.x)(n,c=>{const p=o(c,i++);(p||s)&&n.next(c),!p&&n.complete()}))})}var w=r(7921),P=r(9397),M=r(2096),y=r(1405),b=r(6061),f=r(4134),m=r(4221),X=r(129);const z=(0,m.ZF)(X.qh),W=(0,m.P1)(z,o=>o.timers),D=o=>(0,m.P1)(W,s=>s?s[o]:null);var a=r(6223),d=r(7700),g=r(2296),A=r(2032),h=r(5683);function B(o,s){1&o&&(t.TgZ(0,"mat-error"),t._uU(1,"Please enter a name!"),t.qZA())}function V(o,s){1&o&&(t.TgZ(0,"mat-error"),t._uU(1,"Please enter a valid name!"),t.qZA())}const tt=/^[^\s][\p{L}\d ]*$/u;let et=(()=>{class o{constructor(e,n,i){this.dialogRef=e,this.fb=n,this.store=i,this.createForm=this.fb.group({name:["",[a.kI.required,a.kI.pattern(tt)]]})}get name(){return this.createForm.get("name")}createGroup(){this.createForm.valid&&this.store.dispatch((0,y.sS)({name:this.createForm.value.name}))}close(){this.dialogRef.close()}static#t=this.\u0275fac=function(n){return new(n||o)(t.Y36(d.so),t.Y36(a.qu),t.Y36(m.yh))};static#e=this.\u0275cmp=t.Xpm({type:o,selectors:[["app-create-group"]],decls:15,vars:4,consts:[[1,"create-group"],["mat-dialog-title",""],[1,"create-group__form",3,"formGroup"],["hideRequiredMarker","","appearance","outline",1,"create-group__form"],["formControlName","name","matInput","","placeholder","Name","type","text"],[4,"ngIf"],["mat-dialog-actions",""],["mat-raised-button","","color","primary",3,"disabled","click"],["mat-raised-button","",3,"click"]],template:function(n,i){1&n&&(t.TgZ(0,"div",0)(1,"h1",1),t._uU(2,"Create New Group"),t.qZA(),t.TgZ(3,"form",2)(4,"mat-form-field",3)(5,"mat-label"),t._uU(6,"Name"),t.qZA(),t._UZ(7,"input",4),t.YNc(8,B,2,0,"mat-error",5),t.YNc(9,V,2,0,"mat-error",5),t.qZA()(),t.TgZ(10,"div",6)(11,"button",7),t.NdJ("click",function(){return i.createGroup()}),t._uU(12,"Create"),t.qZA(),t.TgZ(13,"button",8),t.NdJ("click",function(){return i.close()}),t._uU(14,"Cancel"),t.qZA()()()),2&n&&(t.xp6(3),t.Q6J("formGroup",i.createForm),t.xp6(5),t.Q6J("ngIf",null==i.name?null:i.name.hasError("required")),t.xp6(1),t.Q6J("ngIf",null==i.name?null:i.name.hasError("pattern")),t.xp6(2),t.Q6J("disabled",i.createForm.invalid))},dependencies:[l.O5,g.lW,A.Nt,h.KE,h.hX,h.TO,d.uh,d.H8,a._Y,a.Fj,a.JJ,a.JL,a.sg,a.u],styles:[".create-group[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center}.create-group__form[_ngcontent-%COMP%]{width:100%;max-width:300px;margin-bottom:20px}.create-group[_ngcontent-%COMP%]   .mat-dialog-actions[_ngcontent-%COMP%]{width:100%;display:flex;justify-content:center}"]})}return o})(),S=(()=>{class o{constructor(e,n,i,c){this.data=e,this.store=n,this.router=i,this.dialogRef=c,this.isDeleting=!1}deleteGroup(){const{groupId:e,caller:n}=this.data;n?this.store.dispatch((0,y.iE)({groupId:e})):(this.store.dispatch((0,y.iE)({groupId:e})),this.router.navigate(["/"])),this.dialogRef.close()}close(){this.dialogRef.close()}static#t=this.\u0275fac=function(n){return new(n||o)(t.Y36(d.WI),t.Y36(m.yh),t.Y36(u.F0),t.Y36(d.so))};static#e=this.\u0275cmp=t.Xpm({type:o,selectors:[["app-delete-group"]],decls:8,vars:0,consts:[[1,"delete-group"],["mat-dialog-title",""],["mat-dialog-actions",""],["mat-raised-button","","color","primary",3,"click"],["mat-raised-button","",3,"click"]],template:function(n,i){1&n&&(t.TgZ(0,"div",0)(1,"h1",1),t._uU(2,"Delete Group"),t.qZA(),t.TgZ(3,"div",2)(4,"button",3),t.NdJ("click",function(){return i.deleteGroup()}),t._uU(5,"Delete"),t.qZA(),t.TgZ(6,"button",4),t.NdJ("click",function(){return i.close()}),t._uU(7,"Cancel"),t.qZA()()())},dependencies:[g.lW,d.uh,d.H8],styles:[".delete-group[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center}.delete-group[_ngcontent-%COMP%]   .mat-dialog-actions[_ngcontent-%COMP%]{width:100%;display:flex;justify-content:center}"]})}return o})();var G=r(485),$=r(617),U=r(7472);function nt(o,s){if(1&o&&(t.TgZ(0,"h2"),t._uU(1),t.ALo(2,"async"),t.qZA()),2&o){const e=t.oxw();t.xp6(1),t.Oqu(t.lcZ(2,1,e.timerData$))}}function ot(o,s){if(1&o){const e=t.EpF();t.TgZ(0,"button",15),t.NdJ("click",function(){t.CHM(e);const i=t.oxw().$implicit,c=t.oxw(2);return t.KtG(c.openDeleteDialog(i.id.S))}),t.TgZ(1,"mat-icon"),t._uU(2,"delete"),t.qZA()()}}function it(o,s){if(1&o){const e=t.EpF();t.TgZ(0,"mat-list-item",11)(1,"button",12),t.NdJ("click",function(){const c=t.CHM(e).$implicit,p=t.oxw(2);return t.KtG(p.navigateToGroupDetails(c))}),t.TgZ(2,"span"),t._uU(3),t.qZA(),t.TgZ(4,"span",13),t._uU(5),t.ALo(6,"date"),t.qZA()(),t.YNc(7,ot,3,0,"button",14),t.qZA()}if(2&o){const e=s.$implicit,n=t.oxw(2);t.xp6(1),t.Q6J("color",n.isCurrentUserOwner(e)?"primary":""),t.xp6(2),t.Oqu(e.name.S),t.xp6(2),t.Oqu(t.xi3(6,4,e.createdAt.S,"dd.MM.yyyy HH:mm")),t.xp6(2),t.Q6J("ngIf",n.isCurrentUserOwner(e))}}function rt(o,s){if(1&o&&(t.ynx(0),t.TgZ(1,"mat-list",9),t.YNc(2,it,8,7,"mat-list-item",10),t.qZA(),t.BQk()),2&o){const e=s.ngIf;t.xp6(2),t.Q6J("ngForOf",e)}}function st(o,s){1&o&&(t.TgZ(0,"div")(1,"p"),t._uU(2,"Loading..."),t.qZA(),t.TgZ(3,"p"),t._uU(4,"Error occurred while fetching group data"),t.qZA()())}let at=(()=>{class o{constructor(e,n,i,c){this.store=e,this.router=n,this.dialog=i,this.toast=c,this.destroy$=new C.x,this.userData=localStorage.getItem("userData"),this.timerData$=new v.y,this.currentTimeInSeconds=Math.floor(Date.now()/1e3),this.isTimerRunning=!1}ngOnInit(){this.initGroupLoading(),this.initGroupListSubscription(),this.initGetGroupList(),this.initTimer()}initTimer(){this.timerData$=this.store.select(D("group")).pipe((0,T.w)(e=>e?Z(1e3).pipe((0,O.U)(()=>{const n=Date.now(),i=Math.floor((e-n)/1e3);return Math.max(0,i)}),I(n=>n>0),(0,w.O)(Math.floor((e-Date.now())/1e3)),(0,P.b)({complete:()=>{this.initUpdateGroupList(),this.initTimerReset()}})):(0,M.of)(null)))}initGetGroupList(){this.store.dispatch((0,y.hI)())}initUpdateGroupList(){this.store.dispatch((0,y.HJ)())}initTimerReset(){this.store.dispatch((0,f.yo)({groupId:"group"}))}initGroupListSubscription(){this.groupList$=this.store.select(b.F$)}initGroupLoading(){this.loading$=this.store.select(b.mH)}openCreateDialog(){this.dialog.open(et,{width:"350px",height:"250px"})}openDeleteDialog(e){this.dialog.open(S,{width:"350px",height:"150px",data:{groupId:e,caller:!0}}),console.log(e)}updateGroup(){this.timer()}timer(){const e=Date.now()+6e4;this.isTimerRunning=!0,this.store.dispatch((0,f.qv)({groupId:"group",startTime:e}))}isCurrentUserOwner(e){const n=this.userData?JSON.parse(this.userData):null;return e.createdBy.S===(n?n.uid:null)}navigateToGroupDetails(e){localStorage.setItem("existGroup",JSON.stringify(e)),this.store.select((0,b.Ty)(e.id.S)).subscribe(n=>{n?this.router.navigate(["group",e.id.S]):this.toast.showError("Group with this ID does not exist")})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}static#t=this.\u0275fac=function(n){return new(n||o)(t.Y36(m.yh),t.Y36(u.F0),t.Y36(d.uw),t.Y36(G.k))};static#e=this.\u0275cmp=t.Xpm({type:o,selectors:[["app-group-list"]],decls:16,vars:10,consts:[[1,"group-list"],[1,"group-list__header"],[1,"group-list__header-title"],["mat-raised-button","","color","primary",3,"click"],[4,"ngIf"],["mat-raised-button","","color","warn",3,"disabled","click"],[1,"group-list__body"],[4,"ngIf","ngIfElse"],["loadingOrErrorTemplate",""],["role","list"],["role","listitem","ngClass","group-list__body-card",4,"ngFor","ngForOf"],["role","listitem","ngClass","group-list__body-card"],["mat-stroked-button","",1,"group-list__body-card-group",3,"color","click"],[1,"group-list__body-card-group-date"],["mat-icon-button","","color","warn",3,"click",4,"ngIf"],["mat-icon-button","","color","warn",3,"click"]],template:function(n,i){if(1&n&&(t.TgZ(0,"div",0)(1,"div",1)(2,"h1",2),t._uU(3,"Group list"),t.qZA(),t.TgZ(4,"button",3),t.NdJ("click",function(){return i.openCreateDialog()}),t._uU(5,"Create"),t.qZA(),t.YNc(6,nt,3,3,"h2",4),t.ALo(7,"async"),t.TgZ(8,"button",5),t.NdJ("click",function(){return i.updateGroup()}),t.ALo(9,"async"),t._uU(10,"Update"),t.qZA()(),t.TgZ(11,"div",6),t.YNc(12,rt,3,1,"ng-container",7),t.ALo(13,"async"),t.YNc(14,st,5,0,"ng-template",null,8,t.W1O),t.qZA()()),2&n){const c=t.MAs(15);t.xp6(6),t.Q6J("ngIf",null!==t.lcZ(7,4,i.timerData$)),t.xp6(2),t.Q6J("disabled",null!==t.lcZ(9,6,i.timerData$)),t.xp6(4),t.Q6J("ngIf",t.lcZ(13,8,i.groupList$))("ngIfElse",c)}},dependencies:[l.mk,l.sg,l.O5,$.Hw,g.lW,g.RK,U.i$,U.Tg,l.Ov,l.uU],styles:[".group-list[_ngcontent-%COMP%]{width:100%}.group-list__header[_ngcontent-%COMP%]{display:flex;justify-content:space-between}.group-list__body-card[_ngcontent-%COMP%]{padding-top:10px;display:flex;align-items:center;justify-content:space-between}.group-list__body-card-group[_ngcontent-%COMP%]{width:80%;text-align:left;white-space:nowrap;overflow:hidden;margin-right:8px;margin-bottom:1rem}.group-list__body-card-group-date[_ngcontent-%COMP%]{padding-left:1rem;color:#999}"]})}return o})();var k=r(5794),ct=r(6686),N=r(9363),L=r(523);function lt(o,s){if(1&o&&(t.TgZ(0,"h2"),t._uU(1),t.ALo(2,"async"),t.qZA()),2&o){const e=t.oxw();t.xp6(1),t.Oqu(t.lcZ(2,1,e.timerData$))}}function pt(o,s){if(1&o){const e=t.EpF();t.TgZ(0,"button",12),t.NdJ("click",function(){t.CHM(e);const i=t.oxw().$implicit,c=t.oxw(2);return t.KtG(c.conversationCreate(i.uid.S))}),t.TgZ(1,"span"),t._uU(2),t.qZA()()}if(2&o){const e=t.oxw().$implicit,n=t.oxw(2);t.Q6J("color",n.isMatchingConversation(e.uid.S)?"warn":""),t.xp6(2),t.Oqu(e.name.S)}}function ut(o,s){if(1&o&&(t.TgZ(0,"mat-list-item",10),t.YNc(1,pt,3,2,"button",11),t.qZA()),2&o){const e=s.$implicit,n=t.oxw(2);t.xp6(1),t.Q6J("ngIf",n.isCurrentUser(e))}}function mt(o,s){if(1&o&&(t.ynx(0),t.TgZ(1,"mat-list",8),t.YNc(2,ut,2,1,"mat-list-item",9),t.qZA(),t.BQk()),2&o){const e=s.ngIf;t.xp6(2),t.Q6J("ngForOf",e)}}function dt(o,s){1&o&&(t.TgZ(0,"div")(1,"p"),t._uU(2,"Loading..."),t.qZA(),t.TgZ(3,"p"),t._uU(4,"Error occurred while fetching group data"),t.qZA()())}let gt=(()=>{class o{constructor(e,n){this.store=e,this.router=n,this.userData=localStorage.getItem("userData"),this.timerData$=new v.y,this.destroy$=new C.x,this.isTimerRunning=!1}ngOnInit(){this.initGetChatList(),this.initGetConvList(),this.initGroupListSubscription(),this.initTimer()}initTimer(){this.timerData$=this.store.select(D("chat")).pipe((0,T.w)(e=>e?Z(1e3).pipe((0,O.U)(()=>{const n=Date.now(),i=Math.floor((e-n)/1e3);return Math.max(0,i)}),I(n=>n>0),(0,w.O)(Math.floor((e-Date.now())/1e3)),(0,P.b)({complete:()=>{this.initUpdateChatList(),this.initUpdateConvList(),this.initTimerReset()}})):(0,M.of)(null)))}initGetChatList(){this.store.dispatch((0,k.Ag)())}initGetConvList(){this.store.dispatch((0,N.ob)())}initUpdateConvList(){this.store.dispatch((0,N.Z8)())}initGroupListSubscription(){this.chatList$=this.store.select(ct.Z1)}initUpdateChatList(){this.store.dispatch((0,k.P6)())}initTimerReset(){this.store.dispatch((0,f.yo)({groupId:"chat"}))}updateChat(){this.timer()}timer(){const e=Date.now()+6e4;this.isTimerRunning=!0,this.store.dispatch((0,f.qv)({groupId:"chat",startTime:e}))}isCurrentUser(e){const n=this.userData?JSON.parse(this.userData):null;return e.uid.S!==(n?n.uid:null)}isMatchingConversation(e){const n=this.store.select(L.jp);let i=!1;return n.subscribe(c=>{c&&(i=c.some(p=>p.companionID.S===e))}),i}conversationCreate(e){this.store.select((0,L.z4)(e)).subscribe(n=>{n?this.router.navigate(["conversation",n.id.S]):this.store.dispatch((0,N.Xw)({companion:e}))})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}static#t=this.\u0275fac=function(n){return new(n||o)(t.Y36(m.yh),t.Y36(u.F0))};static#e=this.\u0275cmp=t.Xpm({type:o,selectors:[["app-chat-list"]],decls:14,vars:10,consts:[[1,"chat-list"],[1,"chat-list__header"],[1,"chat-list__header-title"],[4,"ngIf"],["mat-raised-button","","color","warn",3,"disabled","click"],[1,"chat-list__body"],[4,"ngIf","ngIfElse"],["loadingOrErrorTemplate",""],["role","list"],["role","listitem","ngClass","chat-list__body-card",4,"ngFor","ngForOf"],["role","listitem","ngClass","chat-list__body-card"],["class","chat-list__body-card-group","mat-raised-button","",3,"color","click",4,"ngIf"],["mat-raised-button","",1,"chat-list__body-card-group",3,"color","click"]],template:function(n,i){if(1&n&&(t.TgZ(0,"div",0)(1,"div",1)(2,"h1",2),t._uU(3,"People list"),t.qZA(),t.YNc(4,lt,3,3,"h2",3),t.ALo(5,"async"),t.TgZ(6,"button",4),t.NdJ("click",function(){return i.updateChat()}),t.ALo(7,"async"),t._uU(8,"Update"),t.qZA()(),t.TgZ(9,"div",5),t.YNc(10,mt,3,1,"ng-container",6),t.ALo(11,"async"),t.YNc(12,dt,5,0,"ng-template",null,7,t.W1O),t.qZA()()),2&n){const c=t.MAs(13);t.xp6(4),t.Q6J("ngIf",null!==t.lcZ(5,4,i.timerData$)),t.xp6(2),t.Q6J("disabled",null!==t.lcZ(7,6,i.timerData$)),t.xp6(4),t.Q6J("ngIf",t.lcZ(11,8,i.chatList$))("ngIfElse",c)}},dependencies:[l.mk,l.sg,l.O5,g.lW,U.i$,U.Tg,l.Ov],styles:[".chat-list[_ngcontent-%COMP%]{width:100%}.chat-list__header[_ngcontent-%COMP%]{display:flex;justify-content:space-between}.chat-list__body-card[_ngcontent-%COMP%]{padding-top:10px;display:flex;align-items:center;justify-content:space-between}.chat-list__body-card-group[_ngcontent-%COMP%]{width:80%;text-align:left;white-space:nowrap;overflow:hidden;margin-right:8px;margin-bottom:1rem}"]})}return o})(),ht=(()=>{class o{static#t=this.\u0275fac=function(n){return new(n||o)};static#e=this.\u0275cmp=t.Xpm({type:o,selectors:[["app-home-page"]],decls:3,vars:0,consts:[[1,"home-container"],[1,"half-width"]],template:function(n,i){1&n&&(t.TgZ(0,"div",0),t._UZ(1,"app-group-list",1)(2,"app-chat-list",1),t.qZA())},dependencies:[at,gt],styles:[".home-container[_ngcontent-%COMP%]{display:flex;justify-content:space-between;gap:2rem;padding:2rem 3rem}.home-container[_ngcontent-%COMP%]   .half-width[_ngcontent-%COMP%]{width:50%}"]})}return o})();var R=r(5119),ft=r(2181),_t=r(144),Y=r(5195);function Ct(o,s){1&o&&(t.TgZ(0,"mat-error"),t._uU(1,"Please enter a name!"),t.qZA())}function yt(o,s){1&o&&(t.TgZ(0,"mat-error"),t._uU(1,"The name is too long!"),t.qZA())}function bt(o,s){1&o&&(t.TgZ(0,"mat-error"),t._uU(1,"Please enter a valid name!"),t.qZA())}function xt(o,s){if(1&o){const e=t.EpF();t.TgZ(0,"button",14),t.NdJ("click",function(){t.CHM(e);const i=t.oxw();return t.KtG(i.toggleNameEdit())}),t.TgZ(1,"mat-icon"),t._uU(2,"edit"),t.qZA()()}}function vt(o,s){if(1&o){const e=t.EpF();t.TgZ(0,"div",15)(1,"button",16),t.NdJ("click",function(){t.CHM(e);const i=t.oxw();return t.KtG(i.saveChanges())}),t._uU(2," Save "),t.qZA(),t.TgZ(3,"button",17),t.NdJ("click",function(){t.CHM(e);const i=t.oxw();return t.KtG(i.cancelChanges())}),t._uU(4,"Cancel"),t.qZA()()}if(2&o){const e=t.oxw();t.xp6(1),t.Q6J("disabled",e.profileForm.invalid)}}const Tt=/^[\p{L} ]+$/u;let Zt=(()=>{class o{constructor(e,n){this.fb=e,this.store=n,this.profileForm=new a.cw({}),this.isNameEditing=!1,this.isStaticPage=!0,this.originalNameValue="",this.destroy$=new C.x,this.profileData$=this.store.select(_t.d).pipe((0,ft.h)(i=>!!i))}ngOnInit(){this.getProfileData(),this.initProfileForm(),this.loadProfileData()}get name(){return this.profileForm.get("name")}getProfileData(){this.store.dispatch((0,R.Ai)())}initProfileForm(){this.profileForm=this.fb.group({uid:[{value:"",disabled:!0}],email:[{value:"",disabled:!0}],created:[{value:"",disabled:!0}],name:[{value:"",disabled:!0},[a.kI.required,a.kI.pattern(Tt),a.kI.maxLength(40)]]})}loadProfileData(){this.profileData$.subscribe(e=>{if(e){const{uid:n,email:i,name:c,createdAt:p}=e,Yt=new Date(parseInt(p?.S||"",10)).toISOString().split("T")[0];this.profileForm.patchValue({uid:n?.S||"",email:i?.S||"",created:Yt,name:c?.S||""})}})}toggleNameEdit(){const e=this.profileForm.get("name");e&&(this.isNameEditing?e.disable():(this.originalNameValue=e.value,this.isStaticPage=!1,e.enable(),e.markAsTouched()),this.isNameEditing=!this.isNameEditing)}cancelChanges(){const e=this.profileForm.get("name");e&&(this.isNameEditing&&(e.patchValue(this.originalNameValue),e.disable()),this.isNameEditing=!1,this.isStaticPage=!0)}saveChanges(){if(this.profileForm.valid){const e=this.profileForm.get("name");e&&this.isNameEditing&&(e.value!==this.originalNameValue&&this.store.dispatch((0,R.ck)({name:e.value})),this.toggleNameEdit(),this.isStaticPage=!0)}}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete(),this.profileForm.reset()}static#t=this.\u0275fac=function(n){return new(n||o)(t.Y36(a.qu),t.Y36(m.yh))};static#e=this.\u0275cmp=t.Xpm({type:o,selectors:[["app-profile"]],decls:27,vars:9,consts:[[1,"container"],[1,"profile"],["ngClass","profile__title"],[1,"profile__form",3,"formGroup"],["hideRequiredMarker","","appearance","outline",1,"profile__form-width"],["formControlName","uid","matInput","","placeholder","uid","type","text",3,"readonly"],["formControlName","email","matInput","","placeholder","Your e-mail"],["formControlName","created","matInput","","type","date",3,"readonly"],[1,"profile__form-width-name"],["hideRequiredMarker","","appearance","outline",3,"ngClass"],["formControlName","name","matInput","","placeholder","Your password","type","text"],[4,"ngIf"],["mat-icon-button","",3,"click",4,"ngIf"],["class","profile__form-update-button",4,"ngIf"],["mat-icon-button","",3,"click"],[1,"profile__form-update-button"],["mat-raised-button","","color","primary",3,"disabled","click"],["mat-raised-button","","color","warn",3,"click"]],template:function(n,i){1&n&&(t.TgZ(0,"div",0)(1,"mat-card",1)(2,"mat-card-title",2),t._uU(3,"Profile"),t.qZA(),t.TgZ(4,"form",3)(5,"mat-form-field",4)(6,"mat-label"),t._uU(7,"Uid"),t.qZA(),t._UZ(8,"input",5),t.qZA(),t.TgZ(9,"mat-form-field",4)(10,"mat-label"),t._uU(11,"Email"),t.qZA(),t._UZ(12,"input",6),t.qZA(),t.TgZ(13,"mat-form-field",4)(14,"mat-label"),t._uU(15,"Creation time"),t.qZA(),t._UZ(16,"input",7),t.qZA(),t.TgZ(17,"div",8)(18,"mat-form-field",9)(19,"mat-label"),t._uU(20,"Name"),t.qZA(),t._UZ(21,"input",10),t.YNc(22,Ct,2,0,"mat-error",11),t.YNc(23,yt,2,0,"mat-error",11),t.YNc(24,bt,2,0,"mat-error",11),t.qZA(),t.YNc(25,xt,3,0,"button",12),t.qZA(),t.YNc(26,vt,5,1,"div",13),t.qZA()()()),2&n&&(t.xp6(4),t.Q6J("formGroup",i.profileForm),t.xp6(4),t.Q6J("readonly",!0),t.xp6(8),t.Q6J("readonly",!0),t.xp6(2),t.Q6J("ngClass",i.isStaticPage?"profile__form-width-name-input":"profile__form-width-name-expanded"),t.xp6(4),t.Q6J("ngIf",null==i.name?null:i.name.hasError("required")),t.xp6(1),t.Q6J("ngIf",null==i.name?null:i.name.hasError("maxlength")),t.xp6(1),t.Q6J("ngIf",null==i.name?null:i.name.hasError("pattern")),t.xp6(1),t.Q6J("ngIf",i.isStaticPage),t.xp6(1),t.Q6J("ngIf",i.isNameEditing))},dependencies:[l.mk,l.O5,$.Hw,g.lW,g.RK,A.Nt,h.KE,h.hX,h.TO,Y.a8,Y.n5,a._Y,a.Fj,a.JJ,a.JL,a.sg,a.u],styles:['@charset "UTF-8";.container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;height:100vh}.profile[_ngcontent-%COMP%]{padding:2rem}.profile__title[_ngcontent-%COMP%]{margin-bottom:1rem}.profile__form[_ngcontent-%COMP%]{min-width:150px;max-width:500px;width:100%}.profile__form-width[_ngcontent-%COMP%], .profile__form-width-name[_ngcontent-%COMP%]{width:100%}.profile__form-width-name-input[_ngcontent-%COMP%]{width:85%;padding-right:1rem}.profile__form-width-name-expanded[_ngcontent-%COMP%]{width:100%}.profile__form-update-button[_ngcontent-%COMP%]{display:flex;justify-content:space-around}']})}return o})(),Ot=(()=>{class o{static#t=this.\u0275fac=function(n){return new(n||o)};static#e=this.\u0275cmp=t.Xpm({type:o,selectors:[["app-profile-page"]],decls:1,vars:0,template:function(n,i){1&n&&t._UZ(0,"app-profile")},dependencies:[Zt]})}return o})();var _=r(9773),J=r(6445),It=r(1099);function wt(o,s){if(1&o&&(t.TgZ(0,"h2"),t._uU(1),t.ALo(2,"async"),t.qZA()),2&o){const e=t.oxw();t.xp6(1),t.Oqu(t.lcZ(2,1,e.timerData$))}}function Pt(o,s){if(1&o){const e=t.EpF();t.TgZ(0,"button",14),t.NdJ("click",function(){t.CHM(e);const i=t.oxw();return t.KtG(i.openDeleteDialog())}),t._uU(1," Delete "),t.qZA()}}const Mt=function(o){return{"group-content__body-dialog":!0,"sent-by-user":o}};function Dt(o,s){if(1&o&&(t.TgZ(0,"div")(1,"div",16)(2,"p"),t._uU(3),t.qZA(),t.TgZ(4,"div",17)(5,"div")(6,"p"),t._uU(7),t.qZA()(),t.TgZ(8,"div")(9,"p"),t._uU(10),t.ALo(11,"date"),t.qZA()()()()()),2&o){const e=s.$implicit,n=t.oxw(2);t.xp6(1),t.Q6J("ngClass",t.VKq(7,Mt,n.isCurrentUser(e.authorID.S))),t.xp6(2),t.hij("",e.authorID.S,":"),t.xp6(4),t.Oqu(e.message.S),t.xp6(3),t.Oqu(t.xi3(11,4,e.createdAt.S,"dd.MM.yy HH:mm"))}}function At(o,s){if(1&o&&(t.TgZ(0,"div"),t.YNc(1,Dt,12,9,"div",15),t.qZA()),2&o){const e=s.ngIf;t.xp6(1),t.Q6J("ngForOf",e)}}function Ut(o,s){1&o&&(t.TgZ(0,"mat-error"),t._uU(1,"Type, please!"),t.qZA())}function Gt(o,s){1&o&&(t.TgZ(0,"mat-error"),t._uU(1,"Min 2 letter"),t.qZA())}let Nt=(()=>{class o{constructor(e,n,i,c,p,x){this.route=e,this.router=n,this.store=i,this.fb=c,this.toast=p,this.dialog=x,this.destroy$=new C.x,this.timerData$=new v.y,this.currentTimeInSeconds=Math.floor(Date.now()/1e3),this.userData=localStorage.getItem("userData"),this.existGroup=localStorage.getItem("existGroup"),this.isTimerRunning=!1,this.sendForm=this.fb.group({message:["",[a.kI.required,a.kI.minLength(2)]]})}ngOnInit(){this.initExistRoute(),this.getNameGroup(),this.initTimer()}initTimer(){this.timerData$=this.store.select(D("groupChat")).pipe((0,T.w)(e=>e?Z(1e3).pipe((0,O.U)(()=>{const n=Date.now(),i=Math.floor((e-n)/1e3);return Math.max(0,i)}),I(n=>n>0),(0,w.O)(Math.floor((e-Date.now())/1e3)),(0,P.b)({complete:()=>{this.initTimerReset(),this.initUpdateGroupList()}})):(0,M.of)(null)))}get message(){return this.sendForm?.get("message")}initTimerReset(){this.store.dispatch((0,f.yo)({groupId:"groupChat"}))}initExistRoute(){this.route.params.pipe((0,_.R)(this.destroy$)).subscribe(e=>{const n=e.groupID;this.store.select((0,b.Ty)(n)).pipe((0,_.R)(this.destroy$)).subscribe(i=>{i?(this.groupId=n,this.getGroupMessagesIfGroupIdDefined()):(this.router.navigate(["/"]),this.toast.showError("This group does not exist"))})})}getGroupMessagesIfGroupIdDefined(){const e=Date.now();this.groupId&&(this.store.dispatch((0,J.S7)({groupID:this.groupId,since:e})),this.groupList$=this.store.select(It.a,{groupID:this.groupId}).pipe((0,_.R)(this.destroy$)))}getNameGroup(){this.groupId&&(this.groupName$=this.store.select((0,b.Ue)(this.groupId)))}updateGroup(){this.timer()}timer(){const e=Date.now()+6e4;this.isTimerRunning=!0,this.store.dispatch((0,f.qv)({groupId:"groupChat",startTime:e}))}initUpdateGroupList(){const e=Date.now();this.groupId&&this.store.dispatch((0,J.Xk)({groupID:this.groupId,since:e}))}send(){if(this.sendForm.invalid)return;const e=this.sendForm.value.message;if(this.groupId){const n=Date.now();this.store.dispatch((0,J.TP)({groupID:this.groupId,message:e,since:n}))}this.sendForm.reset()}isCurrentUser(e){const n=this.userData?JSON.parse(this.userData):null;return e===(n?n.uid:null)}isCurrentUserOwner(){const e=this.userData?JSON.parse(this.userData):null,n=this.existGroup?JSON.parse(this.existGroup):null;return(e?e.uid:null)===(n?n.createdBy.S:null)}openDeleteDialog(){this.dialog.open(S,{width:"350px",height:"150px",data:{groupId:this.groupId,caller:!1}})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete(),this.sendForm.reset()}static#t=this.\u0275fac=function(n){return new(n||o)(t.Y36(u.gz),t.Y36(u.F0),t.Y36(m.yh),t.Y36(a.qu),t.Y36(G.k),t.Y36(d.uw))};static#e=this.\u0275cmp=t.Xpm({type:o,selectors:[["app-group-room-page"]],inputs:{groupId:"groupId"},decls:27,vars:17,consts:[[1,"group-content"],[1,"group-content__header"],["routerLink","/",1,"group-content__header-link"],[1,"group-content__header-right"],[1,"group-content__header-title"],["mat-raised-button","","color","warn",3,"disabled","click"],[4,"ngIf"],["mat-raised-button","","color","warn",3,"click",4,"ngIf"],[1,"group-content__body"],["chatContainer",""],[1,"group-content__form",3,"formGroup","ngSubmit"],["hideRequiredMarker","","appearance","outline",1,"group-content__form-width"],["formControlName","message","matInput","","placeholder","Type some text","type","text","id","message"],["mat-raised-button","","color","primary","type","submit",1,"group-content__form-button",3,"disabled"],["mat-raised-button","","color","warn",3,"click"],[4,"ngFor","ngForOf"],[3,"ngClass"],[1,"message-time-container"]],template:function(n,i){1&n&&(t.TgZ(0,"div",0)(1,"div",1)(2,"a",2),t._uU(3," back to Home "),t.qZA(),t.TgZ(4,"h1"),t._uU(5),t.ALo(6,"async"),t.qZA(),t.TgZ(7,"div",3)(8,"h1",4),t._uU(9,"Group"),t.qZA(),t.TgZ(10,"button",5),t.NdJ("click",function(){return i.updateGroup()}),t.ALo(11,"async"),t._uU(12,"Update"),t.qZA(),t.YNc(13,wt,3,3,"h2",6),t.ALo(14,"async"),t.YNc(15,Pt,2,0,"button",7),t.qZA()(),t.TgZ(16,"div",8,9),t.YNc(18,At,2,1,"div",6),t.ALo(19,"async"),t.qZA(),t.TgZ(20,"form",10),t.NdJ("ngSubmit",function(){return i.send()}),t.TgZ(21,"mat-form-field",11),t._UZ(22,"input",12),t.YNc(23,Ut,2,0,"mat-error",6),t.YNc(24,Gt,2,0,"mat-error",6),t.qZA(),t.TgZ(25,"button",13),t._uU(26," Send "),t.qZA()()()),2&n&&(t.xp6(5),t.Oqu(t.lcZ(6,9,i.groupName$)||"Loading..."),t.xp6(5),t.Q6J("disabled",null!==t.lcZ(11,11,i.timerData$)),t.xp6(3),t.Q6J("ngIf",null!==t.lcZ(14,13,i.timerData$)),t.xp6(2),t.Q6J("ngIf",i.isCurrentUserOwner()),t.xp6(3),t.Q6J("ngIf",t.lcZ(19,15,i.groupList$)),t.xp6(2),t.Q6J("formGroup",i.sendForm),t.xp6(3),t.Q6J("ngIf",null==i.message?null:i.message.hasError("required")),t.xp6(1),t.Q6J("ngIf",null==i.message?null:i.message.hasError("minLength")),t.xp6(1),t.Q6J("disabled",i.sendForm.invalid))},dependencies:[l.mk,l.sg,l.O5,g.lW,A.Nt,h.KE,h.TO,a._Y,a.Fj,a.JJ,a.JL,a.sg,a.u,u.rH,l.Ov,l.uU],styles:[".group-content[_ngcontent-%COMP%]{padding:2rem 3rem}.group-content__header[_ngcontent-%COMP%]{display:flex;justify-content:space-between}.group-content__header-link[_ngcontent-%COMP%]{font-weight:500;text-transform:uppercase;text-decoration:none;color:#423f3f}.group-content__header-link[_ngcontent-%COMP%]:hover{color:#ec5555}.group-content__header-right[_ngcontent-%COMP%]{display:flex;gap:1rem}.group-content__body[_ngcontent-%COMP%]{overflow-y:auto;max-height:70vh}.group-content__body-dialog[_ngcontent-%COMP%]{padding:1rem;width:30%;display:flex;flex-direction:column;margin-bottom:10px;border:1px solid black;border-radius:1rem}.group-content__body-dialog[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0}.group-content__body-dialog[_ngcontent-%COMP%]:nth-child(odd)   p[_ngcontent-%COMP%]:first-child{font-weight:700;color:#333}.group-content__body-dialog[_ngcontent-%COMP%]:nth-child(odd)   .message-time-container[_ngcontent-%COMP%]{display:flex;align-items:baseline;justify-content:space-between;width:100%;gap:5px}.group-content__body-dialog[_ngcontent-%COMP%]:nth-child(odd)   p[_ngcontent-%COMP%]:nth-child(2){margin-top:5px}.group-content__body-dialog[_ngcontent-%COMP%]:nth-child(odd)   p[_ngcontent-%COMP%]:nth-child(3){font-size:.8em;color:#888}.group-content__body-dialog.sent-by-user[_ngcontent-%COMP%]{background-color:#ec5555;color:#fff;border-color:#ec5555;align-self:flex-end;margin-left:auto}.group-content__form[_ngcontent-%COMP%]{position:fixed;bottom:0;left:0;width:98%;display:flex;align-items:center;justify-content:space-between;padding:1rem;background-color:#fff;box-shadow:0 -2px 4px #0000001a}.group-content__form-width[_ngcontent-%COMP%]{flex:1;margin-right:1rem}.message-time-container[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]:first-child{flex:1;overflow:hidden;word-wrap:break-word}"]})}return o})();var F=r(9162),E=r(4487);function Lt(o,s){if(1&o&&(t.TgZ(0,"h2"),t._uU(1),t.ALo(2,"async"),t.qZA()),2&o){const e=t.oxw();t.xp6(1),t.Oqu(t.lcZ(2,1,e.timerData$))}}const Jt=function(o){return{"chat-content__body-dialog":!0,"sent-by-user":o}};function Ft(o,s){if(1&o&&(t.TgZ(0,"div")(1,"div",13)(2,"p"),t._uU(3),t.qZA(),t.TgZ(4,"div",14)(5,"div")(6,"p"),t._uU(7),t.qZA()(),t.TgZ(8,"div")(9,"p"),t._uU(10),t.ALo(11,"date"),t.qZA()()()()()),2&o){const e=s.$implicit,n=t.oxw(2);t.xp6(1),t.Q6J("ngClass",t.VKq(7,Jt,n.isCurrentUser(e.authorID.S))),t.xp6(2),t.hij("",e.authorID.S,":"),t.xp6(4),t.Oqu(e.message.S),t.xp6(3),t.Oqu(t.xi3(11,4,e.createdAt.S,"dd.MM.yy HH:mm"))}}function qt(o,s){if(1&o&&(t.TgZ(0,"div"),t.YNc(1,Ft,12,9,"div",12),t.qZA()),2&o){const e=s.ngIf;t.xp6(1),t.Q6J("ngForOf",e)}}const St=[{path:"",redirectTo:"",pathMatch:"full"},{path:"",component:ht},{path:"profile",component:Ot},{path:"group/:groupID",component:Nt},{path:"conversation/:conversationID",component:(()=>{class o{constructor(e,n,i,c,p,x){this.route=e,this.router=n,this.store=i,this.fb=c,this.toast=p,this.dialog=x,this.destroy$=new C.x,this.userData=localStorage.getItem("userData"),this.timerData$=new v.y,this.currentTimeInSeconds=Math.floor(Date.now()/1e3),this.isTimerRunning=!1,this.sendForm=this.fb.group({message:["",[a.kI.required,a.kI.minLength(2)]]})}ngOnInit(){this.initExistRoute(),this.initTimer()}initTimer(){this.timerData$=this.store.select(D("privateChat")).pipe((0,T.w)(e=>e?Z(1e3).pipe((0,O.U)(()=>{const n=Date.now(),i=Math.floor((e-n)/1e3);return Math.max(0,i)}),I(n=>n>0),(0,w.O)(Math.floor((e-Date.now())/1e3)),(0,P.b)({complete:()=>{this.initTimerReset(),this.initMessages()}})):(0,M.of)(null)))}initTimerReset(){this.store.dispatch((0,f.yo)({groupId:"privateChat"}))}initMessages(){const e=Date.now();this.conversationId&&(this.store.dispatch((0,F.zb)({conversationId:this.conversationId,since:e})),this.messagesList$=this.store.select(E.Bz,{conversationId:this.conversationId}).pipe((0,_.R)(this.destroy$)))}initExistRoute(){this.route.params.pipe((0,_.R)(this.destroy$)).subscribe(e=>{const n=e.conversationID;this.store.select((0,L.L2)(n)).pipe((0,_.R)(this.destroy$)).subscribe(i=>{i?(this.conversationId=n,this.getChatMessagesIfGroupIdDefined()):(this.router.navigate(["/"]),this.toast.showError("This chat does not exist"))})})}getChatMessagesIfGroupIdDefined(){const e=Date.now();this.conversationId&&(this.store.dispatch((0,F.eG)({conversationId:this.conversationId,since:e})),this.messagesList$=this.store.select(E.Bz,{conversationId:this.conversationId}).pipe((0,_.R)(this.destroy$)))}isCurrentUser(e){const n=this.userData?JSON.parse(this.userData):null;return e===(n?n.uid:null)}send(){if(this.sendForm.invalid)return;const e=this.sendForm.value.message;if(this.conversationId){const n=Date.now();this.store.dispatch((0,F.vn)({conversationId:this.conversationId,message:e,since:n}))}this.sendForm.reset()}updateGroup(){this.timer()}timer(){const e=Date.now()+6e4;this.isTimerRunning=!0,this.store.dispatch((0,f.qv)({groupId:"privateChat",startTime:e}))}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete(),this.sendForm.reset()}static#t=this.\u0275fac=function(n){return new(n||o)(t.Y36(u.gz),t.Y36(u.F0),t.Y36(m.yh),t.Y36(a.qu),t.Y36(G.k),t.Y36(d.uw))};static#e=this.\u0275cmp=t.Xpm({type:o,selectors:[["app-chat-room-page"]],decls:20,vars:11,consts:[[1,"chat-content"],[1,"chat-content__header"],["routerLink","/",1,"chat-content__header-link"],[1,"chat-content__header-right"],[1,"chat-content__header-title"],["mat-raised-button","","color","warn",3,"disabled","click"],[4,"ngIf"],[1,"chat-content__body"],[1,"chat-content__form",3,"formGroup","ngSubmit"],["hideRequiredMarker","","appearance","outline",1,"chat-content__form-width"],["formControlName","message","matInput","","placeholder","Type some text","type","text","id","message"],["mat-raised-button","","color","primary","type","submit",1,"chat-content__form-button",3,"disabled"],[4,"ngFor","ngForOf"],[3,"ngClass"],[1,"message-time-container"]],template:function(n,i){1&n&&(t.TgZ(0,"div",0)(1,"div",1)(2,"a",2),t._uU(3," back to Home "),t.qZA(),t.TgZ(4,"div",3)(5,"h1",4),t._uU(6,"Chat"),t.qZA(),t.TgZ(7,"button",5),t.NdJ("click",function(){return i.updateGroup()}),t.ALo(8,"async"),t._uU(9,"Update"),t.qZA(),t.YNc(10,Lt,3,3,"h2",6),t.ALo(11,"async"),t.qZA()(),t.TgZ(12,"div",7),t.YNc(13,qt,2,1,"div",6),t.ALo(14,"async"),t.qZA(),t.TgZ(15,"form",8),t.NdJ("ngSubmit",function(){return i.send()}),t.TgZ(16,"mat-form-field",9),t._UZ(17,"input",10),t.qZA(),t.TgZ(18,"button",11),t._uU(19," Send "),t.qZA()()()),2&n&&(t.xp6(7),t.Q6J("disabled",null!==t.lcZ(8,5,i.timerData$)),t.xp6(3),t.Q6J("ngIf",null!==t.lcZ(11,7,i.timerData$)),t.xp6(3),t.Q6J("ngIf",t.lcZ(14,9,i.messagesList$)),t.xp6(2),t.Q6J("formGroup",i.sendForm),t.xp6(3),t.Q6J("disabled",i.sendForm.invalid))},dependencies:[l.mk,l.sg,l.O5,g.lW,A.Nt,h.KE,a._Y,a.Fj,a.JJ,a.JL,a.sg,a.u,u.rH,l.Ov,l.uU],styles:[".chat-content[_ngcontent-%COMP%]{padding:2rem 3rem}.chat-content__header[_ngcontent-%COMP%]{display:flex;justify-content:space-between}.chat-content__header-link[_ngcontent-%COMP%]{font-weight:500;text-transform:uppercase;text-decoration:none;color:#423f3f}.chat-content__header-link[_ngcontent-%COMP%]:hover{color:#ec5555}.chat-content__header-right[_ngcontent-%COMP%]{display:flex;gap:1rem}.chat-content__body[_ngcontent-%COMP%]{overflow-y:auto;max-height:70vh}.chat-content__body-dialog[_ngcontent-%COMP%]{padding:1rem;width:30%;display:flex;flex-direction:column;margin-bottom:10px;border:1px solid black;border-radius:1rem}.chat-content__body-dialog[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0}.chat-content__body-dialog[_ngcontent-%COMP%]:nth-child(odd)   p[_ngcontent-%COMP%]:first-child{font-weight:700;color:#333}.chat-content__body-dialog[_ngcontent-%COMP%]:nth-child(odd)   .message-time-container[_ngcontent-%COMP%]{display:flex;align-items:baseline;justify-content:space-between;width:100%;gap:5px}.chat-content__body-dialog[_ngcontent-%COMP%]:nth-child(odd)   p[_ngcontent-%COMP%]:nth-child(2){margin-top:5px}.chat-content__body-dialog[_ngcontent-%COMP%]:nth-child(odd)   p[_ngcontent-%COMP%]:nth-child(3){font-size:.8em;color:#888}.chat-content__body-dialog.sent-by-user[_ngcontent-%COMP%]{background-color:#ec5555;color:#fff;border-color:#ec5555;align-self:flex-end;margin-left:auto}.chat-content__form[_ngcontent-%COMP%]{position:fixed;bottom:0;left:0;width:98%;display:flex;align-items:center;justify-content:space-between;padding:1rem;background-color:#fff;box-shadow:0 -2px 4px #0000001a}.chat-content__form-width[_ngcontent-%COMP%]{flex:1;margin-right:1rem}.message-time-container[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]:first-child{flex:1;overflow:hidden;word-wrap:break-word}"]})}return o})()}];let $t=(()=>{class o{static#t=this.\u0275fac=function(n){return new(n||o)};static#e=this.\u0275mod=t.oAB({type:o});static#n=this.\u0275inj=t.cJS({imports:[u.Bz.forChild(St),u.Bz]})}return o})();var kt=r(1921);let Rt=(()=>{class o{static#t=this.\u0275fac=function(n){return new(n||o)};static#e=this.\u0275mod=t.oAB({type:o});static#n=this.\u0275inj=t.cJS({imports:[l.ez,kt.m,$t]})}return o})()}}]);